<html>
    <head>
        <title>Diamond-Square Algorithm</title>
    </head>
    <body>
        <canvas id="myCanvas" width="300" height="300"></canvas>
        <script>
            let c = document.getElementById("myCanvas");
            let ctx = c.getContext("2d");
            let n = 8;
            let w = Math.pow(2, n)+1;
            let h = w;
            let px = ctx.createImageData(w,h);
            let d = px.data;
            console.log(d);
            const pix = (x, y) => 4 * (x + y * w);
            d[pix(0,0)] = Math.floor(Math.random()*255);
            d[pix(0,0)+3] = 255;
            d[pix(0,h-1)] = Math.floor(Math.random()*255);
            d[pix(0,h-1)+3] = 255;
            d[pix(w-1,0)] = Math.floor(Math.random()*255);
            d[pix(w-1,0)+3] = 255;
            d[pix(w-1,h-1)] = Math.floor(Math.random()*255);
            d[pix(w-1,h-1)+3] = 255;
            const square = (x1, y1, w) => {
                let ix1 = pix(x1, y1);
                let ix2 = pix(x1, y1+w-1);
                let ix3 = pix(x1+w-1, y1);
                let ix4 = pix(x1+w-1, y1+w-1);
                let ixc = pix(x1+(w-1)/2, y1+(w-1)/2);
                if(d[ixc+3] === 0){
                    d[ixc] = Math.floor((d[ix1]+d[ix2]+d[ix3]+d[ix4])/4);
                    d[ixc+1] = Math.floor((d[ix1+1]+d[ix2+1]+d[ix3+1]+d[ix4+1])/4);
                    d[ixc+2] = Math.floor((d[ix1+2]+d[ix2+2]+d[ix3+2]+d[ix4+2])/4);
                    d[ixc+3] = 255;
                }
            };
            const diamond = (x1, y1, w, wg) => {
                let ix = [[0, 0], [0, 0], [0, 0], [0, 0]];
                let half = (w-1)/2;
                ix[0] = [x1+half, y1];
                ix[1] = [x1, y1+half];
                ix[2] = [x1+half, w-1];
                ix[3] = [w-1, y1+half];
                for(let i = 0; i < ix.length; i++){
                    let c = 0;
                    let s = 0;
                    let x = 0, y = 1;
                    if(ix[i][x]-half >= 0){
                        c++;
                        let ix1 = pix(ix[i][x]-half, ix[i][y]);
                        s += d[ix1];
                    }
                    if(ix[i][x]+half < wg){
                        c++;
                        let ix2 = pix(ix[i][x]+half, ix[i][y]);
                        s += d[ix2];
                    }
                    if(ix[i][y]-half >= 0){
                        c++;
                        let ix3 = pix(ix[i][x], ix[i][y]-half);
                        s += d[ix3];
                    }
                    if(ix[i][y]+half < wg){
                        c++;
                        let ix4 = pix(ix[i][x], ix[i][y]+half);
                        s += d[ix4];
                    }
                    d[ix[i]] = Math.floor(s/c);
                    d[ix[i]+3] = 255;
                }
            };

            // for(let y = 0; y < h; y++){
            //     for(let x = 0; x < w; x++){
            //         let ix = 4 * (x + y * w);
            //         if(ix % 1 == 0){
            //             d[ix] = 255;
            //             d[ix+1] = 0;
            //             d[ix+2] = 0;
            //             d[ix+3] = 255;
            //         }
            //     }
            // }
            ctx.putImageData(px, 0, 0);
            ctx.stroke();
        </script>
    </body>
</html>